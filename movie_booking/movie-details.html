<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CineTix - Movie Details</title>

  <!-- Tailwind CDN first -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome & custom CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="css/style.css" rel="stylesheet" />

  <!-- movie data -->
  <script src="js/movies.js"></script>
</head>

<body class="flex flex-col min-h-screen bg-gray-900 text-white">
  <header class="bg-black/90 sticky top-0 z-10">
    <div class="container mx-auto px-4 flex justify-between items-center py-4">
      <a href="index.html" class="text-2xl font-bold text-primary-500">CineMax</a>

      <nav class="hidden md:flex space-x-6">
        <a href="index.html" class="hover:text-primary-500">Home</a>
        <a href="index.html#now-showing" class="hover:text-primary-500">Now Showing</a>
        <a href="index.html#upcoming" class="hover:text-primary-500">Upcoming</a>
        <a href="index.html#contact" class="hover:text-primary-500">Contact</a>
      </nav>

      <div class="flex items-center space-x-4">
        <!-- Profile Icon (hidden until login) -->
        <div id="profileContainer" class="hidden items-center space-x-2 cursor-pointer relative">
          <i class="fas fa-user-circle text-3xl text-primary-500"></i>
          <span id="profileName" class="text-sm font-semibold text-gray-300"></span>

          <!-- Dropdown (click to toggle) -->
          <div id="profileDropdown"
            class="absolute top-10 right-0 bg-gray-800 border border-gray-700 rounded-lg p-4 min-w-[14rem] max-w-[18rem] shadow-lg hidden z-20 whitespace-normal">
            <p class="text-gray-300 mb-3 break-words" id="profileEmail"></p>
            <button id="logoutBtn"
              class="w-full bg-primary-600 hover:bg-primary-700 py-2 rounded font-semibold transition">
              Logout
            </button>
          </div>
        </div>

        <!-- Login Button -->
        <a id="loginBtn" href="login.html" class="bg-primary-600 hover:bg-primary-700 px-4 py-2 rounded-lg transition">
          Login / Register
        </a>
      </div>
    </div>
  </header>

  <main class="flex-grow">
    <section class="mt-12 py-12 container mx-auto px-4 max-w-6xl">
      <div id="movie-card" class="grid md:grid-cols-2 gap-8 bg-gray-800 p-8 rounded-lg">
        <!-- left: poster -->
        <div class="flex items-start justify-center">
          <img id="movie-image" src="images/placeholder.jpg" class="rounded-lg max-h-[520px] object-contain"
            alt="poster" />
        </div>

        <!-- right: info -->
        <div>
          <h1 id="movie-title" class="text-4xl font-bold mb-2">Title</h1>
          <p id="movie-meta" class="text-gray-400 mb-4">⭐ rating | duration | genres</p>

          <h3 class="text-2xl font-semibold mb-2">Synopsis</h3>
          <p id="movie-synopsis" class="text-gray-300 mb-6 leading-relaxed">Synopsis goes here</p>

          <h3 class="text-xl font-semibold mb-2">Cast</h3>
          <ul id="movie-cast" class="list-disc list-inside text-gray-300 mb-6"></ul>

          <!-- Trailer Button -->
          <button id="trailerBtn" class="inline-block bg-red-600 hover:bg-red-700 px-6 py-3 rounded-lg text-lg mb-4">
            Watch Trailer
          </button>

          <h3 class="text-xl font-semibold mb-2">Show Times</h3>
          <div id="showtimes" class="flex flex-wrap gap-3 mb-6"></div>

          <a id="continueBooking" href="booking.html"
            class="inline-block bg-primary-600 px-6 py-3 rounded-lg text-lg">Continue to Booking</a>
        </div>
      </div>
    </section>
  </main>
  <!-- Trailer Modal -->
  <div id="trailerModal" class="fixed inset-0 bg-black/70 flex items-center justify-center hidden z-50">
    <div class="bg-gray-900 rounded-lg overflow-hidden w-full max-w-3xl relative">
      <button id="closeTrailer" class="absolute top-2 right-2 text-white text-2xl font-bold">&times;</button>
      <div class="w-full aspect-video">
        <iframe id="trailerIframe" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- footer -->
  <div id="footer"></div>
  <script src="js/include.js"></script>

  <!-- page script: reads ?id=... and populates -->
  <script>
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const movieId = getQueryParam('id') || Object.keys(window.MOVIES || {})[0];
    const movie = (window.MOVIES && window.MOVIES[movieId]) ? window.MOVIES[movieId] : null;

    if (!movie) {
      document.getElementById('movie-card').innerHTML = '<div class="p-8 text-center">Movie not found.</div>';
    } else {
      document.getElementById('movie-image').src = encodeURI(movie.image);
      document.getElementById('movie-title').textContent = movie.title;
      document.getElementById('movie-meta').textContent = `⭐ ${movie.rating} | ${movie.duration} | ${movie.genres}`;
      document.getElementById('movie-synopsis').textContent = movie.synopsis;

      // cast list
      const castEl = document.getElementById('movie-cast');
      castEl.innerHTML = '';
      (movie.cast || []).forEach(c => {
        const li = document.createElement('li'); li.textContent = c; castEl.appendChild(li);
      });

      // showtimes buttons
      const showtimesContainer = document.getElementById('showtimes');
      showtimesContainer.innerHTML = '';
      (movie.showtimes || []).forEach((t, idx) => {
        const btn = document.createElement('button');
        btn.className = 'px-3 py-2 rounded bg-gray-700 hover:bg-primary-600';
        btn.textContent = t;
        btn.addEventListener('click', () => {
          // highlight clicked
          document.querySelectorAll('#showtimes button').forEach(b => b.classList.remove('bg-primary-600'));
          btn.classList.add('bg-primary-600');
          // update continue link to include chosen time
          const href = `booking.html?id=${encodeURIComponent(movie.id)}&time=${encodeURIComponent(t)}`;
          document.getElementById('continueBooking').href = href;
        });
        showtimesContainer.appendChild(btn);

        // default first selected
        if (idx === 0) {
          btn.click();
        }
      });

      // also set continueBooking default (first showtime)
      if (movie.showtimes && movie.showtimes.length > 0) {
        document.getElementById('continueBooking').href = `booking.html?id=${encodeURIComponent(movie.id)}&time=${encodeURIComponent(movie.showtimes[0])}`;
      } else {
        document.getElementById('continueBooking').href = `booking.html?id=${encodeURIComponent(movie.id)}`;
      }
    }

    // Trailer functionality
const trailerBtn = document.getElementById('trailerBtn');
const trailerModal = document.getElementById('trailerModal');
const trailerIframe = document.getElementById('trailerIframe');
const closeTrailer = document.getElementById('closeTrailer');

if (movie && movie.trailer) {
  trailerBtn.addEventListener('click', () => {
    trailerIframe.src = movie.trailer + '?autoplay=1';
    trailerModal.classList.remove('hidden');
  });
}

// close modal
closeTrailer.addEventListener('click', () => {
  trailerModal.classList.add('hidden');
  trailerIframe.src = ''; // stop video
});

// also close if clicked outside video
trailerModal.addEventListener('click', e => {
  if (e.target === trailerModal) {
    trailerModal.classList.add('hidden');
    trailerIframe.src = '';
  }
});

  </script>
</body>

</html>